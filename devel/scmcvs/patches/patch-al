$NetBSD: patch-al,v 1.7 2017/12/18 08:48:27 adam Exp $

--- src/client.c.orig	2005-10-02 15:17:20.000000000 +0000
+++ src/client.c
@@ -1147,7 +1147,6 @@ read_counted_file (char *filename, char 
     size_t nread;
     size_t nwrite;
 
-    FILE *fp;
 
     read_line (&size_string);
     if (size_string[0] == 'z')
@@ -1168,9 +1167,6 @@ protocol error: compressed files not sup
        is binary or not.  I haven't carefully looked into whether
        CVS/Template files should use local text file conventions or
        not.  */
-    fp = CVS_FOPEN (filename, "wb");
-    if (!fp)
-	error (1, errno, "cannot write %s", fullname);
     nread = size;
     nwrite = 0;
     pread = buf;
@@ -1189,16 +1185,11 @@ protocol error: compressed files not sup
 
 	if (nwrite > 0)
 	{
-	    n = fwrite (pwrite, sizeof *pwrite, nwrite, fp);
-	    if (ferror (fp))
-		error (1, errno, "cannot write %s", fullname);
 	    nwrite -= n;
 	    pwrite += n;
 	}
     }
     free (buf);
-    if (fclose (fp) < 0)
-	error (1, errno, "cannot close %s", fullname);
 }
 
 
@@ -4179,6 +4170,16 @@ start_server (void)
 	    error (1, 0,
 		   "This server does not support the global -n option.");
     }
+    if (nolock && !noexec)
+    {
+	if (have_global)
+	{
+	    send_to_server ("Global_option -u\012", 0);
+	}
+	else
+	    error (1, 0,
+		   "This server does not support the global -u option.");
+    }
     if (!cvswrite)
     {
 	if (have_global)
