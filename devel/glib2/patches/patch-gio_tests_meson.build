$NetBSD: patch-gio_tests_meson.build,v 1.9 2024/04/09 16:57:18 wiz Exp $

Work around PR pkg/57399. + DYLD_LIBRARY_PATH for macOS

--- gio/tests/meson.build.orig	2024-03-07 21:35:05.000000000 +0000
+++ gio/tests/meson.build
@@ -798,6 +798,10 @@ if not meson.is_cross_build()
     plugin_resources_c = custom_target('plugin-resources.c',
       input : 'test4.gresource.xml',
       output : 'plugin-resources.c',
+      env : {
+        'LC_ALL': 'en_US.UTF-8',
+        'DYLD_LIBRARY_PATH': '@0@/glib:@0@/gio:@0@/gobject:@0@/gmodule'.replace('@0@', meson.project_build_root())
+      },
       command : [glib_compile_resources,
                  compiler_type,
                  '--target=@OUTPUT@',
@@ -831,6 +835,10 @@ if not meson.is_cross_build()
     input : 'test.gresource.xml',
     depends : test_generated_txt,
     output : 'test.gresource',
+    env : {
+      'LC_ALL': 'en_US.UTF-8',
+      'DYLD_LIBRARY_PATH': '@0@/glib:@0@/gio:@0@/gobject:@0@/gmodule'.replace('@0@', meson.project_build_root())
+    },
     command : [glib_compile_resources,
                compiler_type,
                '--target=@OUTPUT@',
@@ -845,6 +853,10 @@ if not meson.is_cross_build()
   test_resources2_c = custom_target('test_resources2.c',
     input : 'test3.gresource.xml',
     output : 'test_resources2.c',
+    env : {
+      'LC_ALL': 'en_US.UTF-8',
+      'DYLD_LIBRARY_PATH': '@0@/glib:@0@/gio:@0@/gobject:@0@/gmodule'.replace('@0@', meson.project_build_root())
+    },
     command : [glib_compile_resources,
                compiler_type,
                '--target=@OUTPUT@',
@@ -858,6 +870,10 @@ if not meson.is_cross_build()
   test_resources2_h = custom_target('test_resources2.h',
     input : 'test3.gresource.xml',
     output : 'test_resources2.h',
+    env : {
+      'LC_ALL': 'en_US.UTF-8',
+      'DYLD_LIBRARY_PATH': '@0@/glib:@0@/gio:@0@/gobject:@0@/gmodule'.replace('@0@', meson.project_build_root())
+    },
     command : [glib_compile_resources,
                compiler_type,
                '--target=@OUTPUT@',
@@ -872,6 +888,10 @@ if not meson.is_cross_build()
     input : 'test2.gresource.xml',
     depends : big_test_resource,
     output : 'test_resources.c',
+    env : {
+      'LC_ALL': 'en_US.UTF-8',
+      'DYLD_LIBRARY_PATH': '@0@/glib:@0@/gio:@0@/gobject:@0@/gmodule'.replace('@0@', meson.project_build_root())
+    },
     command : [glib_compile_resources,
                compiler_type,
                '--target=@OUTPUT@',
@@ -885,6 +905,10 @@ if not meson.is_cross_build()
   digit_test_resources_c = custom_target('digit_test_resources.c',
     input : '111_digit_test.gresource.xml',
     output : 'digit_test_resources.c',
+    env : {
+      'LC_ALL': 'en_US.UTF-8',
+      'DYLD_LIBRARY_PATH': '@0@/glib:@0@/gio:@0@/gobject:@0@/gmodule'.replace('@0@', meson.project_build_root())
+    },
     command : [glib_compile_resources,
                compiler_type,
                '--target=@OUTPUT@',
@@ -898,6 +922,10 @@ if not meson.is_cross_build()
   digit_test_resources_h = custom_target('digit_test_resources.h',
     input : '111_digit_test.gresource.xml',
     output : 'digit_test_resources.h',
+    env : {
+      'LC_ALL': 'en_US.UTF-8',
+      'DYLD_LIBRARY_PATH': '@0@/glib:@0@/gio:@0@/gobject:@0@/gmodule'.replace('@0@', meson.project_build_root())
+    },
     command : [glib_compile_resources,
                compiler_type,
                '--target=@OUTPUT@',
