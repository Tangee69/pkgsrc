$NetBSD: patch-gio_tests_meson.build,v 1.7 2023/05/20 11:53:10 bacon Exp $

Work around PR pkg/57399. + DYLD_LIBRARY_PATH for macOS

--- gio/tests/meson.build	2023-02-23 21:54:27.000000000 +0800
+++ gio/tests/meson.build	2023-05-16 13:37:44.000000000 +0800
@@ -662,6 +662,10 @@
     plugin_resources_c = custom_target('plugin-resources.c',
       input : 'test4.gresource.xml',
       output : 'plugin-resources.c',
+      env : {
+        'LC_ALL': 'en_US.UTF-8',
+        'DYLD_FALLBACK_LIBRARY_PATH': '@0@/glib:@0@/gio:@0@/gobject:@0@/gmodule'.replace('@0@', meson.project_build_root())
+      },
       command : [glib_compile_resources,
                  compiler_type,
                  '--target=@OUTPUT@',
@@ -690,6 +694,10 @@
   test_gresource = custom_target('test.gresource',
     input : 'test.gresource.xml',
     output : 'test.gresource',
+    env : {
+      'LC_ALL': 'en_US.UTF-8',
+      'DYLD_FALLBACK_LIBRARY_PATH': '@0@/glib:@0@/gio:@0@/gobject:@0@/gmodule'.replace('@0@', meson.project_build_root())
+    },
     command : [glib_compile_resources,
                compiler_type,
                '--target=@OUTPUT@',
@@ -704,6 +712,10 @@
   test_resources2_c = custom_target('test_resources2.c',
     input : 'test3.gresource.xml',
     output : 'test_resources2.c',
+    env : {
+      'LC_ALL': 'en_US.UTF-8',
+      'DYLD_FALLBACK_LIBRARY_PATH': '@0@/glib:@0@/gio:@0@/gobject:@0@/gmodule'.replace('@0@', meson.project_build_root())
+    },
     command : [glib_compile_resources,
                compiler_type,
                '--target=@OUTPUT@',
@@ -717,6 +729,10 @@
   test_resources2_h = custom_target('test_resources2.h',
     input : 'test3.gresource.xml',
     output : 'test_resources2.h',
+    env : {
+      'LC_ALL': 'en_US.UTF-8',
+      'DYLD_FALLBACK_LIBRARY_PATH': '@0@/glib:@0@/gio:@0@/gobject:@0@/gmodule'.replace('@0@', meson.project_build_root())
+    },
     command : [glib_compile_resources,
                compiler_type,
                '--target=@OUTPUT@',
@@ -731,6 +747,10 @@
     input : 'test2.gresource.xml',
     depends : big_test_resource,
     output : 'test_resources.c',
+    env : {
+      'LC_ALL': 'en_US.UTF-8',
+      'DYLD_FALLBACK_LIBRARY_PATH': '@0@/glib:@0@/gio:@0@/gobject:@0@/gmodule'.replace('@0@', meson.project_build_root())
+    },
     command : [glib_compile_resources,
                compiler_type,
                '--target=@OUTPUT@',
@@ -744,6 +764,10 @@
   digit_test_resources_c = custom_target('digit_test_resources.c',
     input : '111_digit_test.gresource.xml',
     output : 'digit_test_resources.c',
+    env : {
+      'LC_ALL': 'en_US.UTF-8',
+      'DYLD_FALLBACK_LIBRARY_PATH': '@0@/glib:@0@/gio:@0@/gobject:@0@/gmodule'.replace('@0@', meson.project_build_root())
+    },
     command : [glib_compile_resources,
                compiler_type,
                '--target=@OUTPUT@',
@@ -757,6 +781,10 @@
   digit_test_resources_h = custom_target('digit_test_resources.h',
     input : '111_digit_test.gresource.xml',
     output : 'digit_test_resources.h',
+    env : {
+      'LC_ALL': 'en_US.UTF-8',
+      'DYLD_FALLBACK_LIBRARY_PATH': '@0@/glib:@0@/gio:@0@/gobject:@0@/gmodule'.replace('@0@', meson.project_build_root())
+    },
     command : [glib_compile_resources,
                compiler_type,
                '--target=@OUTPUT@',
