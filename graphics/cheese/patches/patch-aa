$NetBSD: patch-aa,v 1.3 2008/11/28 14:29:31 jmcneill Exp $

--- configure.ac.orig	2008-10-20 12:01:53.000000000 -0400
+++ configure.ac
@@ -17,8 +17,9 @@ AM_PROG_LIBTOOL
 
 CFLAGS="${CFLAGS} -Wall"
 
-GNOME_MAINTAINER_MODE_DEFINES
-GNOME_COMPILE_WARNINGS
+dnl If you can find where these come from, use them! ;)
+dnl GNOME_MAINTAINER_MODE_DEFINES
+dnl GNOME_COMPILE_WARNINGS
 
 #*******************************************************************************
 # Expanded dirs
@@ -88,7 +89,6 @@ PKG_CHECK_MODULES(CHEESE, \ 
   cairo >= $CAIRO_REQUIRED \
   dbus-1 >= $DBUS_REQUIRED \
   dbus-glib-1 >= $DBUS_GLIB_REQUIRED \
-  hal >= $HAL_REQUIRED \
   pangocairo >= $PANGOCAIRO_REQUIRED \
   librsvg-2.0 >= $LIBRSVG_REQUIRED)
 AC_SUBST(CHEESE_CFLAGS)
@@ -107,6 +107,21 @@ fi
 
 AM_CONDITIONAL(WITH_HILDON, test "x$enable_hildon" = "xyes")
 
+AC_ARG_ENABLE(hal, AS_HELP_STRING([--enable-hal], [Use the HAL library (default=no)]),, enable_hal=no)
+
+if test "x$enable_hal" = "xyes"; then
+  PKG_CHECK_MODULES([HAL], hal >= $HAL_REQUIRED, ac_have_hal=yes, ac_have_hal=no)
+  AC_SUBST(CHEESE_CFLAGS)
+else
+  enable_hal=no
+fi
+
+if test "x$ac_have_hal" = "xyes"; then
+  AC_DEFINE(HAVE_HAL, 1, define to 1 if HAL is used)
+else
+  AC_DEFINE(HAVE_HAL, 0, define to 1 if HAL is used)
+fi
+
 AC_PATH_PROG(GCONFTOOL, gconftool-2)
 AM_GCONF_SOURCE_2
 
