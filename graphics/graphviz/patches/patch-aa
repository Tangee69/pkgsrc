$NetBSD: patch-aa,v 1.10 2009/03/02 11:24:58 tron Exp $

--- configure.ac.orig	2008-10-07 19:40:07.000000000 +0100
+++ configure.ac	2009-03-02 11:04:39.000000000 +0000
@@ -23,17 +23,30 @@
 AC_SUBST(GRAPHVIZ_VERSION_MINOR)
 AC_SUBST(GRAPHVIZ_VERSION_MICRO)
 
-# Windows version numbers
-# For the build number: months since Jan 2000, day of month from the timestamp
-# For the revision number: hour, minute from the timestamp
-
-if test $GRAPHVIZ_VERSION_MICRO = "0"; then
-	GRAPHVIZ_VERSION_BUILD=0
-	GRAPHVIZ_VERSION_REVISION=0
-else
-	GRAPHVIZ_VERSION_BUILD=`expr \( ${GRAPHVIZ_VERSION_MICRO:0:4} - 2000 \) \* 12 + ${GRAPHVIZ_VERSION_MICRO:4:2}`${GRAPHVIZ_VERSION_MICRO:6:2}
-	GRAPHVIZ_VERSION_REVISION=${GRAPHVIZ_VERSION_MICRO:9:4}
-fi
+GRAPHVIZ_VERSION_BUILD=0
+GRAPHVIZ_VERSION_REVISION=0
+case "${host_os}" in
+  *uwin* | *cygwin* | *mingw32* ) 
+	# Windows version numbers
+	# For the build number: months since Jan 2000, day of month from the timestamp
+	# For the revision number: hour, minute from the timestamp
+
+	if test $GRAPHVIZ_VERSION_MICRO = "0"; then
+		GRAPHVIZ_VERSION_BUILD=0
+		GRAPHVIZ_VERSION_REVISION=0
+	else
+		# JR: patch from Michael van Elst:
+		#     if we have a shellm we should have a working awk, too
+		eval `echo "$GRAPHVIZ_VERSION_MICRO" | awk '{
+			print "GRAPHVIZ_VERSION_BUILD=" \
+				(substr($1,1,4)-2000)*12+substr($1,5,2) \
+				substr($1,7,2)
+			print "GRAPHVIZ_VERSION_REVISION=" \
+				substr($1,10,4)
+		}'`
+	fi
+	;;
+esac
 AC_SUBST(GRAPHVIZ_VERSION_BUILD)
 AC_SUBST(GRAPHVIZ_VERSION_REVISION)
 
@@ -267,6 +280,7 @@
 	    ;;
     esac
 else
+echo ${CC}
     case "${CC}" in
 	*icc* )
 	    # -Wall causes relocation errors with icc
@@ -753,7 +767,7 @@
 		        LUA_VERSION=`$PKGCONFIG --modversion lua$l`
                         LUA_INCLUDES="$LUA_CFLAGS "`$PKGCONFIG --cflags lua$l`
                         LUA_LIBS="$LUA_LFLAGS "`$PKGCONFIG --libs lua$l`
-		        LUA_INSTALL_DIR="/usr/lib$LIBPOSTFIX/lua/`$PKGCONFIG --variable=V lua`"
+		        LUA_INSTALL_DIR="${PREFIX}/lib$LIBPOSTFIX/lua/`$PKGCONFIG --variable=V lua`"
     
 		        pkgconfig_lualib_found=`$PKGCONFIG --exists lualib$l 2>/dev/null`
 		        if test  "x$?" = "x0"; then
@@ -775,7 +789,7 @@
                 LUA_INCLUDES=`$LUACONFIG --include`
                 LUA_LIBS=`$LUACONFIG --libs`
 	        LUA_VERSION="5.0.x"
-	        LUA_INSTALL_DIR="/usr/lib$LIBPOSTFIX/lua/5.0"
+	        LUA_INSTALL_DIR="${PREFIX}/lib$LIBPOSTFIX/lua/5.0"
             fi
         fi
     
