$NetBSD: patch-ae,v 1.1 2008/03/08 00:43:55 jlam Exp $

Patch by Marcus Rueckert for staged installation of gems.

--- setup.rb.orig	2007-12-20 20:15:55.000000000 -0500
+++ setup.rb
@@ -24,6 +24,9 @@ if ARGV.include? '--help' then
   puts "  --prefix=DIR         Prefix path for installing RubyGems"
   puts "                       Will not affect gem repository"
   puts
+  puts "  --buildroot=DIR      Staging directory for installing RubyGems (for packagers)"
+  puts "                       Will not affect gem repository"
+  puts
   puts "  --format-executable  Make the gem command's prefix and suffix match ruby's"
   puts "                       If ruby is installed as ruby19, gem will be gem19"
   puts
@@ -74,11 +77,30 @@ else
 
   lib_dir = File.join prefix, 'lib'
   bin_dir = File.join prefix, 'bin'
+end
+
+unless ARGV.grep(/^--buildroot/).empty? then
+  buildroot = nil
+
+  buildroot_arg = ARGV.grep(/^--buildroot=/).first
+  if buildroot_arg =~ /^--buildroot=(.*)/ then
+    buildroot = $1
+  else
+    path_index = ARGV.index '--buildroot'
+    buildroot = ARGV[path_index + 1]
+  end
+
+  buildroot = File.expand_path buildroot
 
-  mkdir_p lib_dir
-  mkdir_p bin_dir
+  raise "invalid --buildroot #{buildroot.inspect}" if buildroot.nil?
+
+  bin_dir = File.join(buildroot, bin_dir)
+  lib_dir = File.join(buildroot, lib_dir)
 end
 
+mkdir_p lib_dir
+mkdir_p bin_dir
+
 Dir.chdir 'lib' do
   lib_files = Dir[File.join('**', '*rb')]
 
