$NetBSD: patch-ae,v 1.3 2008/04/13 06:01:59 jlam Exp $

--- setup.rb.orig	2008-04-01 19:22:20.000000000 -0400
+++ setup.rb
@@ -37,6 +37,9 @@ if ARGV.include? '--help' or ARGV.includ
   puts "  --prefix=DIR           Prefix path for installing RubyGems"
   puts "                         Will not affect gem repository location"
   puts
+  puts "  --install-root=DIR     Root directory for installing RubyGems"
+  puts "                         Will not affect gem repository"
+  puts
   puts "  --no-format-executable Force installation as `gem`"
   puts
   puts "  --no-rdoc              Don't build RDoc for RubyGems"
@@ -96,11 +99,30 @@ else
   else
     lib_dir = File.join prefix, 'lib'
     bin_dir = File.join prefix, 'bin'
-
-    mkdir_p lib_dir
-    mkdir_p bin_dir
   end
 end
+ 
+unless ARGV.grep(/^--install-root/).empty? then
+  install_root = nil
+
+  install_root_arg = ARGV.grep(/^--install-root=/).first
+  if install_root_arg =~ /^--install-root=(.*)/ then
+    install_root = $1
+  else
+    path_index = ARGV.index '--install-root'
+    install_root = ARGV[path_index + 1]
+  end
+
+  install_root = File.expand_path install_root
+
+  raise "invalid --install-root #{install_root.inspect}" if install_root.nil?
+
+  bin_dir = File.join(install_root, bin_dir)
+  lib_dir = File.join(install_root, lib_dir)
+end
+
+mkdir_p lib_dir
+mkdir_p bin_dir
 
 Dir.chdir 'lib' do
   lib_files = Dir[File.join('**', '*rb')]
