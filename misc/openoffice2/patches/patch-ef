$NetBSD: patch-ef,v 1.1 2008/11/24 11:58:44 hira Exp $

--- sysui/desktop/share/create_tree.sh.orig	2008-11-24 16:07:39.000000000 +0900
+++ sysui/desktop/share/create_tree.sh	2008-11-24 16:14:06.000000000 +0900
@@ -1,46 +1,38 @@
 umask 022
 
-if [ "${KDEMAINDIR}" ]
-then
   echo Copying icons .. 
   for i in `cd ${ICON_SOURCE_DIR}; find ${ICON_THEMES:-hicolor/??x?? locolor} -name "*.png"`
   do
-    targetdir=${DESTDIR}/${KDEMAINDIR}/share/icons/`dirname $i`
-    mkdir -p $targetdir
+    targetdir=${DESTDIR}${_PREFIX}/share/icons/`dirname $i`
+    ${BSD_INSTALL_DATA_DIR} $targetdir
     destfile=$targetdir/${ICON_PREFIX:-}${ICON_PREFIX:+-}`basename $i`
-    cp ${ICON_SOURCE_DIR}/$i $destfile
-    chmod 0644 $destfile
+    ${BSD_INSTALL_DATA} ${ICON_SOURCE_DIR}/$i $destfile
   done
-  
-  mkdir -p ${DESTDIR}/${KDEMAINDIR}/share/mimelnk/application
+
+if [ "${KDE}" ]
+then
   for i in `cat mimelnklist`; do
-    cp $i ${DESTDIR}/${KDEMAINDIR}/share/mimelnk/application/${PREFIX}-$i
+    ${BSD_INSTALL_DATA} $i ${DESTDIR}${_PREFIX}/share/mimelnk/application/${PREFIX}-$i
   done
-  chmod 0644 ${DESTDIR}/${KDEMAINDIR}/share/mimelnk/application/*  
 fi
 
-if [ "${GNOMEDIR}" ]
+if [ "${GNOME}" ]
 then
   echo Copying GNOME icons ..
   for i in `cd ${ICON_SOURCE_DIR}/hicolor; find ??x?? -name "*.png"`
   do
-    targetdir=${DESTDIR}/${GNOMEDIR}/share/icons/gnome/`dirname $i`
-    mkdir -p $targetdir
+    targetdir=${DESTDIR}${_PREFIX}/share/icons/gnome/`dirname $i`
     destfile=$targetdir/${ICON_PREFIX:-}${ICON_PREFIX:+-}`basename $i`
-    cp ${ICON_SOURCE_DIR}/hicolor/$i $destfile
-    chmod 0644 $destfile
+    ${BSD_INSTALL_DATA} ${ICON_SOURCE_DIR}/hicolor/$i $destfile
   done
+fi
   
-  mkdir -p ${DESTDIR}/${GNOMEDIR}/share/mime-info
-  cp openoffice.mime ${DESTDIR}/${GNOMEDIR}/share/mime-info/${PREFIX}.mime
-  cp openoffice.keys ${DESTDIR}/${GNOMEDIR}/share/mime-info/${PREFIX}.keys
-  chmod 0644 ${DESTDIR}/${GNOMEDIR}/share/mime-info/${PREFIX}.*
-
-  mkdir -p ${DESTDIR}/${GNOMEDIR}/share/application-registry
-  cp openoffice.applications ${DESTDIR}/${GNOMEDIR}/share/application-registry/${PREFIX}.applications
-  chmod 0644 ${DESTDIR}/${GNOMEDIR}/share/application-registry/${PREFIX}.*
+  ${BSD_INSTALL_DATA} openoffice.mime ${DESTDIR}${_PREFIX}/share/mime-info/${PREFIX}.mime
+  ${BSD_INSTALL_DATA} openoffice.keys ${DESTDIR}${_PREFIX}/share/mime-info/${PREFIX}.keys
 
-  if [ "${GNOME_MIME_THEME}" ]
+  ${BSD_INSTALL_DATA} openoffice.applications ${DESTDIR}${_PREFIX}/share/application-registry/${PREFIX}.applications
+
+  if [ ]
   then 
     echo "Creating legacy mimetype symlinks for GNOME .."
     # add symlinks so that nautilus can identify the mime-icons 
@@ -88,29 +80,22 @@
       ln -sf $link_target_dir${ICON_PREFIX:-}${ICON_PREFIX:+-}extension.png                   ${link_dir}/gnome-mime-application-vnd.openofficeorg.extension.png
     done
   fi
-fi
-
-mkdir -p ${DESTDIR}/usr/bin
 
 # reference symbolic link in /etc for relocatable packages
-office_root=/etc/${PREFIX}
+office_root=${DESTDIR}${OO_PREFIX}
 if [ ! -e "${DESTDIR}/$office_root" -a ! -h "${DESTDIR}/$office_root" ]; then
   office_root=/opt/${PREFIX}
 fi
 
-ln -sf ${office_root}/program/soffice ${DESTDIR}/usr/bin/soffice
-ln -sf ${office_root}/program/unopkg ${DESTDIR}/usr/bin/unopkg
+#ln -sf ${office_root}/program/soffice ${DESTDIR}/usr/bin/soffice
+#ln -sf ${office_root}/program/unopkg ${DESTDIR}/usr/bin/unopkg
+
+${BSD_INSTALL_SCRIPT} openoffice.sh ${DESTDIR}${_PREFIX}/bin/${PREFIX}
+${BSD_INSTALL_SCRIPT} printeradmin.sh ${DESTDIR}${_PREFIX}/bin/${PREFIX}-printeradmin
 
-cp openoffice.sh ${DESTDIR}/usr/bin/${PREFIX}
-cp printeradmin.sh ${DESTDIR}/usr/bin/${PREFIX}-printeradmin
-chmod 0755 ${DESTDIR}/usr/bin/${PREFIX} ${DESTDIR}/usr/bin/${PREFIX}-printeradmin
-
-mkdir -p ${DESTDIR}/usr/share/mime/packages
-cp openoffice.org.xml ${DESTDIR}/usr/share/mime/packages/
-chmod 0644 ${DESTDIR}/usr/share/mime/packages/openoffice.org.xml
+${BSD_INSTALL_DATA} openoffice.org.xml ${DESTDIR}${_PREFIX}/share/mime/packages/
 
-mkdir -p ${DESTDIR}/usr/share/applications
 for i in `cat launcherlist`; do
-  ln -sf ${office_root}/share/xdg/$i ${DESTDIR}/usr/share/applications/${PREFIX}-$i
+  ln -sf ${office_root}/share/xdg/$i ${DESTDIR}${_PREFIX}/share/applications/${PREFIX}-$i
 done
 
