$NetBSD: patch-bc,v 1.2 2015/04/20 13:38:23 rodent Exp $

Bounds checking.

--- lib-src/portsmf/allegrord.cpp.orig	2015-03-02 01:07:05.000000000 +0000
+++ lib-src/portsmf/allegrord.cpp
@@ -169,9 +169,9 @@ bool Alg_reader::parse()
         Alg_parameters_ptr attributes = NULL;
         if (line_parser.peek() == '#') {
             // look for #track
-            line_parser.get_nonspace_quoted(field);
+            line_parser.get_nonspace_quoted(field, field_max);
             if (streql(field.c_str(), "#track")) {
-                line_parser.get_nonspace_quoted(field); // number
+                line_parser.get_nonspace_quoted(field, field_max - strlen(field)); // number
                 field.insert(0, " "); // need char at beginning because
                 // parse_int ignores the first character of the argument
                 track_num = parse_int(field);
@@ -204,7 +204,7 @@ bool Alg_reader::parse()
                     parse_error(field, 0, "#offset specified twice");
                 }
                 offset_found = true;
-                line_parser.get_nonspace_quoted(field); // number
+                line_parser.get_nonspace_quoted(field, field_max); // number
                 field.insert(0, " "); // need char at beginning because
                 // parse_real ignores first character in the argument
                 offset = parse_real(field);
@@ -212,7 +212,7 @@ bool Alg_reader::parse()
         } else {
             // we must have a track to insert into
             if (seq->tracks() == 0) seq->add_track(0);
-            line_parser.get_nonspace_quoted(field);
+            line_parser.get_nonspace_quoted(field, field_max - strlen(field));
             char pk = line_parser.peek();
             // attributes are parsed as two adjacent nonspace_quoted tokens
             // so we have to conditionally call get_nonspace_quoted() again
