<!-- $NetBSD: platforms.xml,v 1.97 2016/07/03 19:25:16 sevan Exp $ -->

<chapter id="platforms">
  <title>Using pkgsrc on systems other than &os;</title>

<sect1 id="binarydist">
<title>Binary distribution</title>

<para>See <xref linkend="using-pkg"/>.</para>

</sect1>

  <sect1 id="bootstrapping-pkgsrc">
    <title>Bootstrapping pkgsrc</title>

    <para>pkgsrc can be bootstrapped for use in two different modes:
    privileged and unprivileged one. In unprivileged mode in contrast
    to privileged one all programs are installed under one particular user
    and cannot utilise privileged operations (packages don't create
    special users and all special file permissions like setuid are ignored).
    </para>

    <para>Installing the bootstrap kit from source should be as simple as:</para>

    <screen>
&rprompt; <userinput>env CVS_RSH=ssh cvs -d anoncvs@anoncvs.NetBSD.org:/cvsroot checkout -P pkgsrc</userinput>
&rprompt; <userinput>cd pkgsrc/bootstrap</userinput>
&rprompt; <userinput>./bootstrap</userinput>
    </screen>

    <para>To bootstrap in unprivileged mode pass <quote>--unprivileged</quote> flag to <command>bootstrap</command></para>

    <para>By default, in privileged mode pkgsrc uses
    <filename>/usr/pkg</filename> for <emphasis>prefix</emphasis>
    where programs will be installed in,
    and <filename>/var/db/pkg</filename> for the package database
    directory where pkgsrc will do its internal bookkeeping,
    <filename>/var</filename> is used as <emphasis>varbase</emphasis>,
    where packages install their persistent data.
    In unprivileged mode pkgsrc uses
    <filename>~/pkg</filename> for <emphasis>prefix</emphasis>,
    <filename>~/pkg/var/db/pkg</filename> for the package database,
    and <filename>~/pkg/var</filename> for <emphasis>varbase</emphasis>.
    </para>

    <para>You can change default layout using command-line arguments.
    Run <quote>./bootstrap --help</quote> to get details.
    </para>

    <note>
      <para>The bootstrap installs a <command>bmake</command> tool.
      Use this <command>bmake</command> when building via pkgsrc.
      For examples in this guide, use <command>bmake</command>
      instead of <quote>make</quote>.</para>
    </note>

    <note>
      <para>It is possible to bootstrap multiple instances of pkgsrc
      using non-intersecting directories. Use <command>bmake</command>
      corresponding to the installation you're working with to build
      and install packages.
      </para>
    </note>

  </sect1>

  <sect1 id="platform-specific-notes">
    <title>Platform-specific notes</title>

    <para>For details related to supported versions consult the platform-specific README files found in <xref linkend="supported-platforms"/></para>

    <sect2 id="interix">
      <title>Interix</title>

      <para>Interix is a POSIX-compatible subsystem for the Windows NT kernel,
      providing a Unix-like environment with a tighter kernel integration than
      available with Cygwin.  It is part of the Windows Services for Unix
      package, available for free for any licensed copy of Windows 2000, XP
      (not including XP Home), or 2003.  SFU can be downloaded from <ulink
      url="http://www.microsoft.com/windows/sfu/">http://www.microsoft.com/windows/sfu/</ulink>.</para>

      <para>Services for Unix 3.5 has been tested.  3.0 or 3.1 may work, but
      are not officially supported.  (The main difference in 3.0/3.1 is lack
      of pthreads, but other parts of libc may also be lacking.)</para>

      <para>Services for Unix Applications (aka SUA) is an integrated
      component of Windows Server 2003 R2 (5.2), Windows Vista and
      Windows Server 2008 (6.0), Windows 7 and Windows Server 2008 R2
      (6.1).  As of this writing, the SUA's Interix 6.0 (32bit) and
      6.1 (64bit) subsystems have been tested.  Other versions may
      work as well. The Interix 5.x subsystem has not yet been tested
      with pkgsrc.</para>

      <sect3 id="platform.interix-sfu-install">
	<title>When installing Interix/SFU</title>

	<para>At an absolute minimum, the following packages must be installed from
	the Windows Services for Unix 3.5 distribution in order to use pkgsrc:</para>

	<itemizedlist>
	  <listitem><para>Utilities -&gt; Base Utilities</para></listitem>
	  <listitem><para>Interix GNU Components -&gt; (all)</para></listitem>
	  <listitem><para>Remote Connectivity</para></listitem>
	  <listitem><para>Interix SDK</para></listitem>
	</itemizedlist>

	<para>When using pkgsrc on Interix, DO NOT install the Utilities subcomponent
	"UNIX Perl".  That is Perl 5.6 without shared module support, installed to
	/usr/local, and will only cause confusion. Instead, install Perl 5.8 from
	pkgsrc (or from a binary package).</para>

	<para>The Remote Connectivity subcomponent "Windows Remote Shell Service" does
	not need to be installed, but Remote Connectivity itself should be
	installed in order to have a working inetd.</para>

	<para>During installation you may be asked whether to enable setuid
	behavior for Interix programs, and whether to make pathnames default to
	case-sensitive.  Setuid should be enabled, and case-sensitivity MUST be
	enabled.  (Without case-sensitivity, a large number of packages including
	perl will not build.)</para>

	<para>NOTE:  Newer Windows service packs change the way binary execution
	works (via the Data Execution Prevention feature).  In order to use
	pkgsrc and other gcc-compiled binaries reliably, a hotfix containing
	POSIX.EXE, PSXDLL.DLL, PSXRUN.EXE, and PSXSS.EXE (899522 or newer)
	must be installed.  Hotfixes are available from Microsoft through a
	support contract; however, Debian Interix Port has made most Interix
	hotfixes available for personal use from <ulink
	url="http://www.debian-interix.net/hotfixes/">http://www.debian-interix.net/hotfixes/</ulink>.</para>

	<para>In addition to the hotfix noted above, it may be necessary to
	disable Data Execution Prevention entirely to make Interix functional.
	This may happen only with certain types of CPUs; the cause is not fully
	understood at this time.  If gcc or other applications still segfault
	repeatedly after installing one of the hotfixes note above, the
	following option can be added to the appropriate "boot.ini" line on the
	Windows boot drive:  /NoExecute=AlwaysOff
	(WARNING, this will disable DEP completely, which may be a security
	risk if applications are often run as a user in the Administrators
	group!)</para>

      </sect3>

      <sect3 id="platform.interix-sfu-postinstall">
	<title>What to do if Interix/SFU is already installed</title>

	<para>If SFU is already installed and you wish to alter these settings to work
	with pkgsrc, note the following things.</para>

	<itemizedlist>
	  <listitem>
	    <para>To uninstall UNIX Perl, use Add/Remove Programs, select Microsoft
	    Windows Services for UNIX, then click Change.  In the installer, choose
	    Add or Remove, then uncheck Utilities-&gt;UNIX Perl.</para>
	  </listitem>
	  <listitem>
	    <para>To enable case-sensitivity for the file system, run REGEDIT.EXE, and
	    change the following registry key:</para>
	    <para>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\kernel</para>
	    <para>Set the DWORD value "obcaseinsensitive" to 0; then reboot.</para>
	  </listitem>
	  <listitem>
	    <para>To enable setuid binaries (optional), run REGEDIT.EXE, and change the
	    following registry key:</para>
	    <para>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Services for UNIX</para>
	    <para>Set the DWORD value "EnableSetuidBinaries" to 1; then reboot.</para>
	  </listitem>
	</itemizedlist>

      </sect3>
      <sect3 id="platform.interix-notes">
	<title>Important notes for using pkgsrc</title>

	<para>The package manager (either the pkgsrc "su" user, or the user
	running "pkg_add") must be a member of the local Administrators
	group.  Such a user must also be used to run the bootstrap.  This is
	slightly relaxed from the normal pkgsrc requirement of "root".</para>

	<para>The package manager should use a umask of 002.  "make install" will
	automatically complain if this is not the case.  This ensures that
	directories written in /var/db/pkg are Administrators-group writeable.</para>

	<para>The popular Interix binary packages from http://www.interopsystems.com/
	use an older version of pkgsrc's pkg_* tools.  Ideally, these should
	NOT be used in conjunction with pkgsrc.  If you choose to use them at
	the same time as the pkgsrc packages, ensure that you use the proper
	pkg_* tools for each type of binary package.</para>

	<para>The TERM setting used for DOS-type console windows (including those
	invoked by the csh and ksh startup shortcuts) is "interix".  Most systems
	don't have a termcap/terminfo entry for it, but the following .termcap
	entry provides adequate emulation in most cases:</para>

	<programlisting>
interix:kP=\E[S:kN=\E[T:kH=\E[U:dc@:DC@:tc=pcansi:
	</programlisting>

      </sect3>
      <sect3 id="platform.interix-limits">
	<title>Limitations of the Interix platform</title>

	<para>Though Interix suffices as a familiar and flexible substitute
	for a full Unix-like platform, it has some drawbacks that should
	be noted for those desiring to make the most of Interix.</para>

	<itemizedlist>

	  <listitem><para><emphasis role="strong">X11:</emphasis></para>
	  <para>Interix comes with the standard set of X11R6 client libraries,
	  and can run X11 based applications, but it does
	  <emphasis>not</emphasis> come with an X server.  Some options are
	  <ulink url="http://www.starnet.com/products/xwin32/">StarNet X-Win32</ulink>,
	  <ulink url="http://connectivity.hummingbird.com/products/nc/exceed/">Hummingbird Exceed</ulink>
	  (available in a trimmed version for Interix from Interop Systems as the
	  <ulink url="http://www.interopsystems.com/InteropXserver.htm">Interop X Server</ulink>),
	  and the free X11 server included with
	  <ulink url="http://x.cygwin.com/">Cygwin</ulink>.</para>
	  </listitem>

	  <listitem><para><emphasis role="strong">X11 acceleration:</emphasis></para>
	  <para>Because Interix runs in a completely different NT subsystem from
	  Win32 applications, it does not currently support various X11
	  protocol extensions for acceleration (such as MIT-SHM or DGA).
	  Most interactive applications to a local X server will run
	  reasonably fast, but full motion video and other graphics
	  intensive applications may require a faster-than-expected CPU.</para></listitem>

	  <listitem><para><emphasis role="strong">Audio:</emphasis></para>
	  <para>Interix has no native support for audio output.  For audio
	  support, pkgsrc uses the <command>esound</command> client/server
	  audio system on Interix.  Unlike on most platforms, the
	  <filename role="pkg">audio/esound</filename> package does
	  <emphasis>not</emphasis> contain the <command>esd</command>
	  server component.  To output audio via an Interix host, the
	  <filename role="pkg">emulators/cygwin_esound</filename> package
	  must also be installed.</para></listitem>

	  <listitem><para><emphasis role="strong">CD/DVDs, USB, and SCSI:</emphasis></para>
	  <para>Direct device access is not currently supported in Interix, so it
	  is not currently possible to access CD/DVD drives, USB devices,
	  or SCSI devices through non-filesystem means.  Among other things,
	  this makes it impossible to use Interix directly for CD/DVD
	  burning.</para></listitem>

	  <listitem><para><emphasis role="strong">Tape drives:</emphasis></para>
	  <para>Due to the same limitations as for CD-ROMs and SCSI devices, tape
	  drives are also not directly accessible in Interix.  However,
	  support is in work to make tape drive access possible by using
	  Cygwin as a bridge (similarly to audio bridged via Cygwin's
	  esound server).</para></listitem>

	</itemizedlist>
      </sect3>
      <sect3 id="platform.interix-knownissues">
	<title>Known issues for pkgsrc on Interix</title>

	<para>It is not necessary, in general, to have a "root" user on the
	Windows system; any member of the local Administrators group will
	suffice.  However, some packages currently assume that the user
	named "root" is the privileged user.  To accommodate these, you
	may create such a user; make sure it is in the local group
	Administrators (or your language equivalent).</para>

	<para><command>pkg_add</command> creates directories of mode
	0755, not 0775, in <filename>$PKG_DBDIR</filename>.  For the
	time being, install packages as the local Administrator (or
	your language equivalent), or run the following command after
	installing a package to work around the issue:</para>

	<screen>
&rprompt; <userinput>chmod -R g+w $PKG_DBDIR</userinput>
	</screen>

      </sect3>
    </sect2>
  </sect1>
</chapter>
