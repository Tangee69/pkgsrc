$NetBSD: patch-ad,v 1.1 2008/06/20 13:55:49 joerg Exp $

--- gdb/sim/netbsd/netbsd.c.orig	2008-06-20 15:26:09.000000000 +0200
+++ gdb/sim/netbsd/netbsd.c
@@ -467,7 +467,11 @@ write_struct_statfs(EMUL_ADDR dst, struc
   WRITE_LONG(dst, src->f_syncwrites); dst += EMUL_SIZEOF_LONG;
   WRITE_LONG(dst, src->f_asyncwrites); dst += EMUL_SIZEOF_LONG;
   /* f_spare[1]; */ dst += EMUL_SIZEOF_LONG;
+#if __NetBSD_Version__ >= 499002500
+  write_memory(dst, src->f_fstypename, sizeof(src->f_fstypename));
+#else
   write_memory(dst, src->f_fstypename, MFSNAMELEN + MNAMELEN + MNAMELEN);
+#endif
 }
 
 
@@ -2357,8 +2361,10 @@ do__sysctl(void)  /* XXX */
           break;
         case HW_DISKNAMES:
           xfatal("sysctl HW_DISKNAMES not implemented\n");  // XXX
+#ifdef HW_DISKSTATS
         case HW_DISKSTATS:
           xfatal("sysctl HW_DISKSTATS not implemented\n");  // XXX
+#endif
         case HW_MACHINE_ARCH:
           strcpy(buf, EMUL_HW_MACHINE_ARCH);
           bufsize = strlen(buf) + 1;
@@ -2444,9 +2450,15 @@ do__sysctl(void)  /* XXX */
         case KERN_SAVED_IDS:
         case KERN_SECURELVL:
         case KERN_SYNCHRONIZED_IO:
+#ifdef KER_SYSVMSG
         case KERN_SYSVMSG:
+#endif
+#ifdef KERN_SYSVSEM
         case KERN_SYSVSEM:
+#endif
+#ifdef KERN_SYSVSHM
         case KERN_SYSVSHM:
+#endif
           /* int */
           {
             status = sysctl(tmp_name, namelen,
@@ -2537,7 +2549,9 @@ do__sysctl(void)  /* XXX */
         case KERN_NTPTIME: // XXX struct ntptimeval
         case KERN_PROC: // XXX struct kinfo_proc
         case KERN_PROF:  // XXX node
+#if KERN_SYSVIPC_INFO != KERN_OSTYPE
         case KERN_SYSVIPC_INFO: // XXX node
+#endif
         case KERN_TKSTAT: // XXX node
         case KERN_VNODE: // XXX struct vnode
           xfatal("sysctl CTL_KERN:0x%x not implemented\n", tmp_name[1]);
