#!@SH@
# $NetBSD: bulkbuild-restart,v 1.1 2008/04/04 17:58:59 joerg Exp $

. @PBULK_CONFIG@

set -e

check_list() {
	while read pkg
	do
		grep -q "^PKGNAME=${pkg}$" ${loc}/presolve && continue
		return 1
	done < "$1"
	return 0
}

if [ ! -e ${loc}/success -o ! -e ${loc}/error ]; then
	restart_build=no
elif ! check_list ${loc}/success; then
	restart_build=no
elif ! check_list ${loc}/error; then
	restart_build=no
else
	restart_build=yes
fi
if [ "$restart_build" = "no" ]; then
	${script_phase_pre_build}
	${script_phase_scan}
fi
${script_phase_build}
${script_phase_report}
${script_phase_upload}
