# $NetBSD: Makefile,v 1.4 2024/06/20 16:52:29 abs Exp $

PKGNAME=	${DISTNAME:S/-/-embedded-/}
PKGREVISION=	3
COMMENT=	MariaDB 10.11, a free MySQL compatible database (embedded)

# for the header files needed by the installed header file of this package
DEPENDS+=	mariadb-client-10.11.*:../../databases/mariadb1011-client

.include "../../databases/mariadb1011-client/Makefile.common"

# For building the embedded server, we need to build the server
# but that installs _a lot_ of extra files, which we do not want
# to avoid a conflict with the -server- package. So manually remove them.
#
# This is ugly, so if you know a better solution, please improve this.

CMAKE_ARGS+=		-DCONNECT_WITH_MONGO=NO
CMAKE_ARGS+=		-DWITH_EMBEDDED_SERVER=ON

post-install:
	for file in \
		bin/aria_chk \
		bin/aria_dump_log \
		bin/aria_ftdump \
		bin/aria_pack \
		bin/aria_read_log \
		bin/aria_s3_copy \
		bin/innochecksum \
		bin/mariabackup \
		bin/mariadb-backup \
		bin/mariadb-fix-extensions \
		bin/mariadb-install-db \
		bin/mariadb-ldb \
		bin/mariadb-tzinfo-to-sql \
		bin/mariadb-waitpid \
		bin/mariadbd-multi \
		bin/mariadbd-safe \
		bin/mariadbd-safe-helper \
		bin/mbstream \
		bin/my_print_defaults \
		bin/myisam_ftdump \
		bin/myisamchk \
		bin/myisamlog \
		bin/myisampack \
		bin/myrocks_hotbackup \
		bin/mysql_fix_extensions \
		bin/mysql_install_db \
		bin/mysql_ldb \
		bin/mysql_tzinfo_to_sql \
		bin/mysql_waitpid \
		bin/mysqld_multi \
		bin/mysqld_safe \
		bin/mysqld_safe_helper \
		bin/perror \
		bin/replace \
		bin/resolve_stack_dump \
		bin/resolveip \
		bin/sst_dump \
		bin/wsrep_sst_backup \
		bin/wsrep_sst_common \
		bin/wsrep_sst_mariabackup \
		bin/wsrep_sst_mysqldump \
		bin/wsrep_sst_rsync \
		bin/wsrep_sst_rsync_wan \
		include/mysql/server/private/authors.h \
		include/mysql/server/private/backup.h \
		include/mysql/server/private/bounded_queue.h \
		include/mysql/server/private/client_settings.h \
		include/mysql/server/private/compat56.h \
		include/mysql/server/private/contributors.h \
		include/mysql/server/private/create_options.h \
		include/mysql/server/private/create_tmp_table.h \
		include/mysql/server/private/cset_narrowing.h \
		include/mysql/server/private/custom_conf.h \
		include/mysql/server/private/datadict.h \
		include/mysql/server/private/ddl_log.h \
		include/mysql/server/private/debug.h \
		include/mysql/server/private/debug_sync.h \
		include/mysql/server/private/derived_handler.h \
		include/mysql/server/private/derror.h \
		include/mysql/server/private/des_key_file.h \
		include/mysql/server/private/discover.h \
		include/mysql/server/private/event_data_objects.h \
		include/mysql/server/private/event_db_repository.h \
		include/mysql/server/private/event_parse_data.h \
		include/mysql/server/private/event_queue.h \
		include/mysql/server/private/event_scheduler.h \
		include/mysql/server/private/events.h \
		include/mysql/server/private/field.h \
		include/mysql/server/private/field_comp.h \
		include/mysql/server/private/filesort.h \
		include/mysql/server/private/filesort_utils.h \
		include/mysql/server/private/gcalc_slicescan.h \
		include/mysql/server/private/gcalc_tools.h \
		include/mysql/server/private/grant.h \
		include/mysql/server/private/group_by_handler.h \
		include/mysql/server/private/gstream.h \
		include/mysql/server/private/ha_handler_stats.h \
		include/mysql/server/private/ha_partition.h \
		include/mysql/server/private/ha_sequence.h \
		include/mysql/server/private/handle_connections_win.h \
		include/mysql/server/private/handler.h \
		include/mysql/server/private/hash_filo.h \
		include/mysql/server/private/hostname.h \
		include/mysql/server/private/init.h \
		include/mysql/server/private/innodb_priv.h \
		include/mysql/server/private/item.h \
		include/mysql/server/private/item_cmpfunc.h \
		include/mysql/server/private/item_create.h \
		include/mysql/server/private/item_func.h \
		include/mysql/server/private/item_geofunc.h \
		include/mysql/server/private/item_jsonfunc.h \
		include/mysql/server/private/item_row.h \
		include/mysql/server/private/item_strfunc.h \
		include/mysql/server/private/item_subselect.h \
		include/mysql/server/private/item_sum.h \
		include/mysql/server/private/item_timefunc.h \
		include/mysql/server/private/item_vers.h \
		include/mysql/server/private/item_windowfunc.h \
		include/mysql/server/private/item_xmlfunc.h \
		include/mysql/server/private/json_table.h \
		include/mysql/server/private/key.h \
		include/mysql/server/private/keycaches.h \
		include/mysql/server/private/lex.h \
		include/mysql/server/private/lex_charset.h \
		include/mysql/server/private/lex_hash.h \
		include/mysql/server/private/lex_string.h \
		include/mysql/server/private/lex_symbol.h \
		include/mysql/server/private/lex_token.h \
		include/mysql/server/private/lock.h \
		include/mysql/server/private/log.h \
		include/mysql/server/private/log_event.h \
		include/mysql/server/private/log_event_data_type.h \
		include/mysql/server/private/log_event_old.h \
		include/mysql/server/private/log_slow.h \
		include/mysql/server/private/mariadb.h \
		include/mysql/server/private/mdl.h \
		include/mysql/server/private/mem_root_array.h \
		include/mysql/server/private/message.h \
		include/mysql/server/private/multi_range_read.h \
		include/mysql/server/private/my_apc.h \
		include/mysql/server/private/my_decimal.h \
		include/mysql/server/private/my_json_writer.h \
		include/mysql/server/private/mysqld.h \
		include/mysql/server/private/mysqld_suffix.h \
		include/mysql/server/private/opt_histogram_json.h \
		include/mysql/server/private/opt_range.h \
		include/mysql/server/private/opt_subselect.h \
		include/mysql/server/private/opt_trace.h \
		include/mysql/server/private/opt_trace_context.h \
		include/mysql/server/private/parse_file.h \
		include/mysql/server/private/partition_element.h \
		include/mysql/server/private/partition_info.h \
		include/mysql/server/private/privilege.h \
		include/mysql/server/private/procedure.h \
		include/mysql/server/private/protocol.h \
		include/mysql/server/private/proxy_protocol.h \
		include/mysql/server/private/records.h \
		include/mysql/server/private/repl_failsafe.h \
		include/mysql/server/private/replication.h \
		include/mysql/server/private/rowid_filter.h \
		include/mysql/server/private/rpl_constants.h \
		include/mysql/server/private/rpl_filter.h \
		include/mysql/server/private/rpl_gtid.h \
		include/mysql/server/private/rpl_injector.h \
		include/mysql/server/private/rpl_mi.h \
		include/mysql/server/private/rpl_parallel.h \
		include/mysql/server/private/rpl_record.h \
		include/mysql/server/private/rpl_record_old.h \
		include/mysql/server/private/rpl_reporting.h \
		include/mysql/server/private/rpl_rli.h \
		include/mysql/server/private/rpl_tblmap.h \
		include/mysql/server/private/rpl_utility.h \
		include/mysql/server/private/scheduler.h \
		include/mysql/server/private/select_handler.h \
		include/mysql/server/private/semisync.h \
		include/mysql/server/private/semisync_master.h \
		include/mysql/server/private/semisync_master_ack_receiver.h \
		include/mysql/server/private/semisync_slave.h \
		include/mysql/server/private/session_tracker.h \
		include/mysql/server/private/set_var.h \
		include/mysql/server/private/slave.h \
		include/mysql/server/private/socketpair.h \
		include/mysql/server/private/sp.h \
		include/mysql/server/private/sp_cache.h \
		include/mysql/server/private/sp_head.h \
		include/mysql/server/private/sp_pcontext.h \
		include/mysql/server/private/sp_rcontext.h \
		include/mysql/server/private/spatial.h \
		include/mysql/server/private/sql_acl.h \
		include/mysql/server/private/sql_admin.h \
		include/mysql/server/private/sql_alloc.h \
		include/mysql/server/private/sql_alter.h \
		include/mysql/server/private/sql_analyse.h \
		include/mysql/server/private/sql_analyze_stmt.h \
		include/mysql/server/private/sql_array.h \
		include/mysql/server/private/sql_audit.h \
		include/mysql/server/private/sql_base.h \
		include/mysql/server/private/sql_basic_types.h \
		include/mysql/server/private/sql_binlog.h \
		include/mysql/server/private/sql_bitmap.h \
		include/mysql/server/private/sql_bootstrap.h \
		include/mysql/server/private/sql_cache.h \
		include/mysql/server/private/sql_callback.h \
		include/mysql/server/private/sql_class.h \
		include/mysql/server/private/sql_cmd.h \
		include/mysql/server/private/sql_connect.h \
		include/mysql/server/private/sql_const.h \
		include/mysql/server/private/sql_crypt.h \
		include/mysql/server/private/sql_cte.h \
		include/mysql/server/private/sql_cursor.h \
		include/mysql/server/private/sql_db.h \
		include/mysql/server/private/sql_debug.h \
		include/mysql/server/private/sql_delete.h \
		include/mysql/server/private/sql_derived.h \
		include/mysql/server/private/sql_digest.h \
		include/mysql/server/private/sql_digest_stream.h \
		include/mysql/server/private/sql_do.h \
		include/mysql/server/private/sql_error.h \
		include/mysql/server/private/sql_explain.h \
		include/mysql/server/private/sql_expression_cache.h \
		include/mysql/server/private/sql_get_diagnostics.h \
		include/mysql/server/private/sql_handler.h \
		include/mysql/server/private/sql_help.h \
		include/mysql/server/private/sql_hset.h \
		include/mysql/server/private/sql_i_s.h \
		include/mysql/server/private/sql_insert.h \
		include/mysql/server/private/sql_join_cache.h \
		include/mysql/server/private/sql_lex.h \
		include/mysql/server/private/sql_lifo_buffer.h \
		include/mysql/server/private/sql_limit.h \
		include/mysql/server/private/sql_list.h \
		include/mysql/server/private/sql_load.h \
		include/mysql/server/private/sql_locale.h \
		include/mysql/server/private/sql_manager.h \
		include/mysql/server/private/sql_mode.h \
		include/mysql/server/private/sql_parse.h \
		include/mysql/server/private/sql_partition.h \
		include/mysql/server/private/sql_partition_admin.h \
		include/mysql/server/private/sql_plist.h \
		include/mysql/server/private/sql_plugin.h \
		include/mysql/server/private/sql_plugin_compat.h \
		include/mysql/server/private/sql_prepare.h \
		include/mysql/server/private/sql_priv.h \
		include/mysql/server/private/sql_profile.h \
		include/mysql/server/private/sql_reload.h \
		include/mysql/server/private/sql_rename.h \
		include/mysql/server/private/sql_repl.h \
		include/mysql/server/private/sql_schema.h \
		include/mysql/server/private/sql_select.h \
		include/mysql/server/private/sql_sequence.h \
		include/mysql/server/private/sql_servers.h \
		include/mysql/server/private/sql_show.h \
		include/mysql/server/private/sql_signal.h \
		include/mysql/server/private/sql_sort.h \
		include/mysql/server/private/sql_statistics.h \
		include/mysql/server/private/sql_string.h \
		include/mysql/server/private/sql_table.h \
		include/mysql/server/private/sql_test.h \
		include/mysql/server/private/sql_time.h \
		include/mysql/server/private/sql_trigger.h \
		include/mysql/server/private/sql_truncate.h \
		include/mysql/server/private/sql_tvc.h \
		include/mysql/server/private/sql_type.h \
		include/mysql/server/private/sql_type_fixedbin.h \
		include/mysql/server/private/sql_type_fixedbin_storage.h \
		include/mysql/server/private/sql_type_geom.h \
		include/mysql/server/private/sql_type_int.h \
		include/mysql/server/private/sql_type_json.h \
		include/mysql/server/private/sql_type_real.h \
		include/mysql/server/private/sql_type_string.h \
		include/mysql/server/private/sql_udf.h \
		include/mysql/server/private/sql_union.h \
		include/mysql/server/private/sql_update.h \
		include/mysql/server/private/sql_view.h \
		include/mysql/server/private/sql_window.h \
		include/mysql/server/private/strfunc.h \
		include/mysql/server/private/structs.h \
		include/mysql/server/private/sys_vars_shared.h \
		include/mysql/server/private/table.h \
		include/mysql/server/private/table_cache.h \
		include/mysql/server/private/thr_malloc.h \
		include/mysql/server/private/thread_cache.h \
		include/mysql/server/private/threadpool.h \
		include/mysql/server/private/threadpool_generic.h \
		include/mysql/server/private/threadpool_winsockets.h \
		include/mysql/server/private/transaction.h \
		include/mysql/server/private/tzfile.h \
		include/mysql/server/private/tztime.h \
		include/mysql/server/private/uniques.h \
		include/mysql/server/private/unireg.h \
		include/mysql/server/private/vers_string.h \
		include/mysql/server/private/win_tzname_data.h \
		include/mysql/server/private/winservice.h \
		include/mysql/server/private/wsrep_allowlist_service.h \
		include/mysql/server/private/wsrep_applier.h \
		include/mysql/server/private/wsrep_binlog.h \
		include/mysql/server/private/wsrep_client_service.h \
		include/mysql/server/private/wsrep_client_state.h \
		include/mysql/server/private/wsrep_condition_variable.h \
		include/mysql/server/private/wsrep_high_priority_service.h \
		include/mysql/server/private/wsrep_mutex.h \
		include/mysql/server/private/wsrep_mysqld.h \
		include/mysql/server/private/wsrep_mysqld_c.h \
		include/mysql/server/private/wsrep_on.h \
		include/mysql/server/private/wsrep_priv.h \
		include/mysql/server/private/wsrep_schema.h \
		include/mysql/server/private/wsrep_server_service.h \
		include/mysql/server/private/wsrep_server_state.h \
		include/mysql/server/private/wsrep_sst.h \
		include/mysql/server/private/wsrep_status.h \
		include/mysql/server/private/wsrep_storage_service.h \
		include/mysql/server/private/wsrep_thd.h \
		include/mysql/server/private/wsrep_trans_observer.h \
		include/mysql/server/private/wsrep_types.h \
		include/mysql/server/private/wsrep_utils.h \
		include/mysql/server/private/wsrep_var.h \
		include/mysql/server/private/wsrep_xid.h \
		include/mysql/server/private/xa.h \
		lib/libmysqlservices.a \
		lib/mysql/plugin/adt_null.so \
		lib/mysql/plugin/auth_0x0100.so \
		lib/mysql/plugin/auth_ed25519.so \
		lib/mysql/plugin/auth_gssapi.so \
		lib/mysql/plugin/auth_pam.so \
		lib/mysql/plugin/auth_pam_tool_dir/auth_pam_tool \
		lib/mysql/plugin/auth_pam_v1.so \
		lib/mysql/plugin/auth_test_plugin.so \
		lib/mysql/plugin/daemon_example.ini \
		lib/mysql/plugin/debug_key_management.so \
		lib/mysql/plugin/dialog_examples.so \
		lib/mysql/plugin/disks.so \
		lib/mysql/plugin/example_key_management.so \
		lib/mysql/plugin/file_key_management.so \
		lib/mysql/plugin/func_test.so \
		lib/mysql/plugin/ha_archive.so \
		lib/mysql/plugin/ha_blackhole.so \
		lib/mysql/plugin/ha_connect.so \
		lib/mysql/plugin/ha_federated.so \
		lib/mysql/plugin/ha_federatedx.so \
		lib/mysql/plugin/ha_rocksdb.so \
		lib/mysql/plugin/ha_s3.so \
		lib/mysql/plugin/ha_sphinx.so \
		lib/mysql/plugin/ha_spider.so \
		lib/mysql/plugin/ha_test_sql_discovery.so \
		lib/mysql/plugin/handlersocket.so \
		lib/mysql/plugin/hashicorp_key_management.so \
		lib/mysql/plugin/libdaemon_example.so \
		lib/mysql/plugin/locales.so \
		lib/mysql/plugin/metadata_lock_info.so \
		lib/mysql/plugin/mypluglib.so \
		lib/mysql/plugin/password_reuse_check.so \
		lib/mysql/plugin/provider_bzip2.so \
		lib/mysql/plugin/provider_lzma.so \
		lib/mysql/plugin/qa_auth_client.so \
		lib/mysql/plugin/qa_auth_interface.so \
		lib/mysql/plugin/qa_auth_server.so \
		lib/mysql/plugin/query_cache_info.so \
		lib/mysql/plugin/query_response_time.so \
		lib/mysql/plugin/server_audit.so \
		lib/mysql/plugin/simple_password_check.so \
		lib/mysql/plugin/sql_errlog.so \
		lib/mysql/plugin/test_sql_service.so \
		lib/mysql/plugin/test_versioning.so \
		lib/mysql/plugin/type_mysql_json.so \
		lib/mysql/plugin/type_mysql_timestamp.so \
		lib/mysql/plugin/type_test.so \
		lib/mysql/plugin/wsrep_info.so \
		lib/security/pam_user_map.so \
		sbin/mariadbd \
		sbin/mysqld \
		share \
		; do \
			rm -rf ${DESTDIR}${PREFIX}/$$file; \
		done

.include "../../archivers/bzip2/buildlink3.mk"
.include "../../archivers/xz/buildlink3.mk"
.include "../../databases/mariadb1011-client/buildlink3.mk"
.include "../../devel/libexecinfo/buildlink3.mk"
.include "../../security/tcp_wrappers/buildlink3.mk"
.include "../../textproc/libxml2/buildlink3.mk"
.include "../../mk/bsd.pkg.mk"
