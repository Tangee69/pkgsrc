$NetBSD: patch-am,v 1.1 2009/02/11 12:42:59 drochner Exp $

--- gst/qtdemux/qtdemux.c.orig	2005-08-29 13:50:51.000000000 +0200
+++ gst/qtdemux/qtdemux.c
@@ -2360,7 +2360,7 @@ qtdemux_parse_trak (GstQTDemux * qtdemux
     n_sample_times = QTDEMUX_GUINT32_GET (stts->data + 12);
     timestamp = 0;
     index = 0;
-    for (i = 0; i < n_sample_times; i++) {
+    for (i = 0; (i < n_sample_times) && (index < n_samples); i++) {
       int n;
       int duration;
       guint64 time;
@@ -2368,7 +2368,7 @@ qtdemux_parse_trak (GstQTDemux * qtdemux
       n = QTDEMUX_GUINT32_GET (stts->data + 16 + 8 * i);
       duration = QTDEMUX_GUINT32_GET (stts->data + 16 + 8 * i + 4);
       time = (GST_SECOND * duration) / stream->timescale;
-      for (j = 0; j < n; j++) {
+      for (j = 0; (j < n) && (index < n_samples); j++) {
         //GST_INFO("moo %lld", timestamp);
         samples[index].timestamp = timestamp;
         samples[index].duration = time;
